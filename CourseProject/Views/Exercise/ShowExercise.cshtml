@using System.Net
@using Microsoft.AspNet.Identity
@model CourseProject.Models.Exercise
@{
    ViewBag.Title = Model.Name;
}
<h1>Show exercise with tag</h1>
<div class="jumbotron">
    @{
        bool active = true;
        bool author = false;
        <br />
        <h4>
            @Model.Name
            <h5>
                (
                @if (Model.Active)
                {
                    active = true;
                    @Resources.Resource.Active
                    if (Model.Author.Id != User.Identity.GetUserId())
                    {
                        if (ViewBag.IsRightAnsweredUser)
                        {
                            @Resources.Resource.Answered
                        }
                        else
                        {
                            @Resources.Resource.SendAnswer
                            <div>
                                @using (Html.BeginForm("SendAnswer", "Exercise"))
                                {
                                    <input value="@Model.Id" hidden="true">
                                    <input type="text" placeholder="" id="input-text" name="text" />
                                    <input type="submit" id="text" value="Send" />
                                }
                            </div>
                        }
                    }
                    else
                    {
                        author = true;
                    }
                }
                else
                {
                    @Resources.Resource.Unactive
                    active = false;
                }
                )
            </h5>
        </h4>
        <div >
            Author: <a href = "~/Profile/ShowProfile/@Model.Author.Id"> @Model.Author.UserName </a>
                @if(!author){
                @Resources.Resource.NotifyAboutMistake

                using (Html.BeginForm("WriteToAuthor", "Exercise"))
                {
                    <input value="@Model.Id" hidden="true">
                    <input type="text" placeholder="" id="input-text" name="text" />
                    <input type="submit" id="text" value="Send" />
                }
            }
            <h4>@Resources.Resource.Tags</h4>
            <div class="row">
                @foreach (var tag in Model.Tags)
                {
                    <div class="col-md-5">
                        @Html.ActionLink(tag.Text, "ShowExercisesWithTag", "Exercise", new { tag = tag.Text }, null)
                    </div>
                }
            </div>
            <h4>@Resources.Resource.Category @Model.Category.Text</h4>
            <h4>@Resources.Resource.TriesOfAnswers @Model.TriesOfAnswers</h4>
            <h4>@Resources.Resource.RightAnsweredUsers</h4>
            <div>
                @if (@Model.RightAnsweredUsers.Count != 0)
                {
                    foreach (var user in Model.RightAnsweredUsers)
                    {
                        @Html.ActionLink(user.UserName, "ShowProfile", "Profile", new { id = user.Id }, null)
                    }
                }
                else
                {
                    @Resources.Resource.NoRightAnsweredUsers
                }
            </div>
            <br>
            @Model.Text
            @if (Model.Equations.Count != 0)
            {
                @Resources.Resource.Formulas
                <div>
                    @foreach (var equation in Model.Equations)
                    {
                        @equation.Path
                    }
                </div>
            }
            @if (Model.Graphs.Count != 0)
            {
                @Resources.Resource.Graphs
                <div>
                    @foreach (var graph in Model.Graphs)
                    {
                        @graph.Path
                    }
                </div>
            }
            @if (Model.Pictures.Count != 0)
            {
                @Resources.Resource.Pictures
                <div>
                    @foreach (var picture in Model.Pictures)
                    {
                        @picture.Path
                    }
                </div>
            }
            @if (Model.Videos.Count != 0)
            {
                @Resources.Resource.Videos
                <div>
                    @foreach (var video in Model.Videos)
                    {
                        @video.Path
                    }
                </div>
            }
            @if (active)
            {
                using (Html.BeginForm("AddEvaluation", "Exercise"))
                {
                    <input value="@Model.Id" hidden="true">
                    <button type="submit" class="btn btn-primary btn-sm" name="evaluationButton" value="like"><span class="glyphicon glyphicon-thumbs-up"></span> @Model.Evaluations.Select(ev => ev.Type == true).Count()</button>
                    <button type="submit" class="btn btn-primary btn-sm" name="evaluationButton" value="dislike"><span class="glyphicon glyphicon-thumbs-down"></span> @Model.Evaluations.Select(ev => ev.Type == false).Count()</button>
                }
                using (Html.BeginForm("AddComment", "Exercise"))
                {
                    <input value="@Model.Id" hidden="true">
                    <input type="text" placeholder="" id="input-text" name="text" />
                    <input type="submit" id="text" value="Send" />
                }
            }
            <div class="comments">
                @if (Model.Comments.Count != 0)
                {
                    <div>
                        @foreach (var comment in Model.Comments)
                        {
                            <a href="~/Profile/ShowProfile/@comment.Author.Id">@comment.Author.UserName</a>
                            <br />
                            <p> @comment.Text</p>
                        }
                    </div>
                    <hr>
                }
            </div>
        </div>
    }
</div>
